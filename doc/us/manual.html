<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>The Xavante Lua Web Server Manual</title>
    <link rel="stylesheet" href="http://www.keplerproject.org/doc.css" type="text/css"/>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>

<body>

<div id="container">

<div id="product">
	<div id="product_logo"><a href="http://www.keplerproject.org">
		<img alt="Xavante logo" src="xavante.gif"/>
	</a></div>
	<div id="product_name"><big><strong>Xavante</strong></big></div>
	<div id="product_description">A Lua Web Server with CGILua support</div>
</div> <!-- id="product" -->

<div id="main">

<div id="navigation">
<h1>Xavante</h1>
	<ul>
		<li><a href="index.html">Home</a>
            <ul>
              <li><a href="index.html#over">Overview</a></li>
              <li><a href="index.html#status">Status</a></li>
              <li><a href="index.html#download">Download</a></li>
              <li><a href="index.html#history">History</a></li>
              <li><a href="index.html#components">Dependencies</a></li>
              <li><a href="index.html#portability">Portability</a></li>
              <li><a href="index.html#credits">Credits</a></li>
              <li><a href="index.html#contact">Contact us</a></li>
            </ul>
        </li>
		<li><strong>Manual</strong>
            <ul>
              <li><a href="manual.html#install">Installing</a></li>
              <li><a href="manual.html#config">Configuring</a></li>
              <li><a href="manual.html#running">Running</a></li>
            </ul>
        </li>
        <li><a href="sajax.html">Sajax</a></li>
        <li><a href="license.html">License</a></li>
	</ul>
</div> <!-- id="navigation" -->

<div id="content">

<h2><a name="install"></a>Installing</h2>

<p>Xavante follows the
<a href="http://www.keplerproject.org/compat/">package model</a>
for Lua 5.1, therefore it should be "installed". Refer to
<a href="http://www.keplerproject.org/compat/manual.html#configuration">
Compat-5.1 configuration</a> section about how to install the compiled
binary properly.</p>

<p>Windows users can use the pre-compiled version of Xavante's components
(LuaFileSystem and LuaSocket) available at
<a href="http://luaforge.net">LuaForge</a>.</p>

<p>The default directory structure for Xavante is based on four directories:</p>

<p><code>$BIN</code> is where are located the binary libraries for Lua,
LuaSocket and LuaFileSystem</p>

<p><code>$LUA</code> is where are located the Lua libraries for Xavante,
CGILua, Compat-5.1, Copas, coxpcall, LuaSocket, Sajax and VEnv.</p>

<p><code>$CONF</code> is where are located the user configuration files
for Xavante and CGILua.</p>

<p><code>$WEB</code> is where are located the Xavante default HTTP documents.</p>

<p>Xavante can be installed by copying its files and its dependencies to this directory
structure. An example of a LuaBinaries compatible Xavante installation for Windows
is shown below with the list of included files and in what projects they can be found in
<a href="http://luaforge.net">LuaForge</a>.</p>

<p>Note that the Xavante source includes a file <code>t_xavante_start.lua</code>. This is
a template for the Xavante startup file. You must edit it so it reflects your system paths
and then rename it to <code>xavante_start.lua</code>.</p>

<pre class="example">
    $BIN
        lfs.dll           -- <a href="http://luaforge.net/projects/luafilesystem/files">LuaFileSystem</a>
        lmime.dll         -- <a href="http://luaforge.net/projects/luasocket/files">LuaSocket</a>
        lsocket.dll       -- LuaSocket
        lua.exe           -- <a href="http://luaforge.net/projects/luabinaries/files">LuaBinaries</a>
        lua50.dll         -- LuaBinaries
        xavante_start.lua -- Xavante (t_xavante_start.lua)
    
    $LUA
        /cgilua           -- <a href="http://luaforge.net/projects/cgilua/files">CGILua</a>
            ...        
        /copas            -- <a href="http://luaforge.net/projects/copas/files">Copas</a>
            ...
        /coxpcall         -- Xavante
            coxpcall.lua
        /sajax            -- Xavante
            sajax.lua
        /socket           -- LuaSocket
            ...
        /xavante          -- Xavante
            ...
        compat-5.1.lua    -- <a href="http://luaforge.net/projects/compat/files">Compat</a>
        ltn12.lua         -- LuaSocket
        mime.lua          -- LuaSocket
        stable.lua        -- <a href="http://luaforge.net/projects/venv/files">VEnv</a>
        venv.lua          -- VEnv
    
    $CONF
        /cgilua
          config.lua      -- CGILua
        /xavante
          config.lua      -- Xavante
        
    $WEB
        /doc              -- Xavante
            ...
        /img              -- Xavante
            ...
        index.lp          -- Xavante
        test.lp           -- Xavante
</pre>

<p>The example below shows the startup file <code>xavante_start.lua</code>
for the default Windows installation (on <code>c:\xavante</code> for example).</p>

<pre class="example">
-- Default directory for documents and scripts
local XAVANTE_WEB  = [[c:/xavante/web]]  

--- compatibility code for Lua version 5.0 providing 5.1 behavior
if string.find (_VERSION, "Lua 5.0") and not _COMPAT51 then
	if not LUA_PATH then
		LUA_PATH = [[c:/xavante/conf/?.lua;
                    c:/xavante/lua/?.lua;
                    c:/xavante/lua/?/?.lua]]
	end
	require"compat-5.1"
	package.cpath = [[c:/xavante/bin/?.dll;
                    c:/xavante/bin/l?.dll]]
end

require "xavante.server"

xavante.setwebdir(XAVANTE_WEB)
xavante.start(XAVANTE_ISFINISHED, XAVANTE_TIMEOUT)
</pre>

<h2><a name="config"></a>Configuring</h2>

<p>The file <code>$BIN/xavante/config.lua</code> defines the
Xavante configuration. This file is usually copied to the
<code>$CONF/xavante</code> directory to make it easier to upgrade
a Xavante installation.</p>

<p>Xavante defines <em>virtualhosts</em> for each site
that it is running. Each virtualhost can define a set of <em>rules</em> for it.
Each rule matches a <em>URL pattern</em> with a handler.
Xavante currently offers a <strong>file handler</strong>,
a <strong>redirect handler</strong> and
a <strong>CGILua handler</strong> for general files, URL
remapping and CGILua scripts respectively.</p>

<p>A typical <code>config.lua</code> uses the format below</p>

<pre class="example">
require "xavante.filehandler"
require "xavante.cgiluahandler"
require "xavante.redirecthandler"

local simplerules = {
    -- URL remapping example
    {match = "/", with = xavante.redirecthandler,
    params = {"index.lp"}}, 
    -- filehandler example
    {match = "/*", with = xavante.filehandler,
    params = {baseDir = xavante.webdir()}},
    -- cgiluahandler example
    {match = {"/*.lp", "/*.lua"},
    with = xavante.cgiluahandler.makeHandler (xavante.webdir())},
}

xavante.HTTP{
    server = {host = "*", port = 80},
    
    defaultHost = {
    	rules = simplerules
    },
}
</pre>

<p>To use virtual hosts with Xavante, the call to <code>xavante.HTTP</code>
would be changed to something like</p>

<pre class="example">
xavante.HTTP{
    server = {host = "*", port = 80},
    
    defaultHost = {},
    
    virtualhosts = {
        ["www.sitename.com"] = simplerules
    }
}</pre>


<h2><a name="running"></a>Running</h2>
<p>Running Xavante requires the execution of the correctly set
<code>xavante_start.lua</code>. This can be done through a 
<code>.bat</code> file in Windows, or by giving execution rights to
the <code>xavante_start.lua</code> on Linux.</p>

<p>Remember that <code>xavante_start.lua</code> is the configured version of 
<code>t_xavante_start.lua</code> and if you are
<a href="#install">installing</a> Xavante from the source
files you should edit it first.</p>

<p>After calling <code>xavante_start.lua</code>, opening the URL
<code>http://localhost</code> on your browser should show the Xavante welcome page.
If you changed the port number on <code>config.lua</code> you should also use this
port number in the URL.</p>

<p>The welcome page presents the Xavante version and links to the documentation and
for a simple set of tests.</p>

</div> <!-- id="content" -->

</div> <!-- id="main" -->

<div id="about">
	<p><a href="http://validator.w3.org/check?uri=referer">
    <img src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0!" height="31" width="88" /></a></p>
	<p><small>$Id: manual.html,v 1.12 2005/06/21 15:39:23 carregal Exp $</small></p>
</div> <!-- id="about" -->

</div> <!-- id="container" -->

</body>
</html>
